language: node_js
dist: trusty
sudo: false
node_js:
- '6'
services:
- docker
before_install:
- cp examples/components/* components/
- cp examples/spec/* spec/
- if [ "$TARGET" == "raspberrypi3" ]; then docker run --rm --privileged multiarch/qemu-user-static:register --reset; fi
before_script:
- docker -v
- docker-compose -v
- docker-compose up -d
- docker-compose ps
- until ./node_modules/.bin/fbp-protocol-healthcheck ws://127.0.0.1:3569 || (( count++ >= 10 )); do echo "Waiting for runtime to be ready"; sleep 10; done
after_success:
- if [ "$TRAVIS_BRANCH" == "master" ]; then docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"; docker push "$DOCKER_IMAGE"; fi
matrix:
  include:
  - env: TARGET=x86 DOCKER_IMAGE=msgflo/msgflo-project DOCKER_FILE=Dockerfile
  - env: TARGET=raspberrypi3 DOCKER_IMAGE=msgflo/raspberrypi3-msgflo-project COMPOSE_FILE=docker-compose-raspberrypi3.yml DOCKER_FILE=Dockerfile-raspberrypi3
    sudo: true
env:
  global:
  - secure: miJtGDRtmBlS6QEaV/mjG2idVZpEyvLbm9mHYwWRZ8vo9T7PL8/GMCGRFvn0/atUL2fIMlVAl2LbB0Eiz1kO2X+dDs+a8aJKjDNUhn/Rh07e21Yn4XBnxMsxBORPWh5A3p4Rmu2XpMK3K4WH6LSbcuSNnn0AhDta+5IoEaWZV3dNFfoDAUcCT6Gxf/hoC9uW4Ia4yqPCRYcfOgPo9UHNCP+CVb7W93vyeyxUXpXs5+9fNYqSw5KThpA0ZdK59Irj7NOzHwDVZt48/2I+gTQoSvR7sZKiv+WC5joRrDPtEc7BErMm7dV/cfu2GHeyliN0qAfJM396m3ohDURIE1owpPiGVqo8EzJ15i+xD44e6agBAx87Qp5lcHeWNC++naF01xIMnr6BHeI3vMuw9qmFSJ/cf6rk6fUQvA/y1t/0lPMVmOj1aleuRihvVS+tRg3Lq9mbQ0hZlDjgxab/1YFo7EThiFIsFBFTK/FH8tqnAerJzI5cthNU9JSTi/mLBRVdsUgNb6st/8sJeuBcn9qnDly58BEU0U4bamvngGQXjFPaOhNGTfAFUBegGJsEbHVLjILx9HnEs/EHbO1r0I36P36jx83lLMF9dgfR0yxnKMUtNvKqwVHoolNHOGbT51fpSk/5XwsmI08Xk2fW+O2vMsxCkvMlzy0fU9RlB8LqDjc=
  - secure: bRtjRmJca//BmcOxqTtlTm+YeBptyYkZM7E6bcuZ0r/5T8hqUuv132nBTvBY8+WTybOw4Lu5ImSD3LiXaqpJT+Iktdgk1BZAryc1LhGI7nlhSSbmkIiKBC5hMYTWcPJp95/j6pQmLNf1WJwoVgnSN7uW84HB4Ry+82i2nCxG0qOXtOv3lwhlu4edERprAUIkhxJlRbQcTqPKem5tgcaYohwkDiiXZyU4hHhiwU1hCjWKrsoMhmX7mn1PzV/zbdI0juT/l7bmKmOEHV5MFbzFzsXM/eBgD5M17qDsGb83hUjxyn+fAPFdZ+J2zcfmPksBOklWEd66c0WydV8sC2BPZrQP4bOJkEGc46xhCf7hmPxNKegZ8xfA21fm7Pfj6on5pUIR8kj8AMBcEEBd7l3nN1u6djI8iQ1uswAb8ad1xGJTiaFFJcI+1ukGrTFaZd6KliuMC0a7419KvabcNXALx92PHF2DgF93zBufbUUJa7lGR4kDdvWLz7rsKWTcUhARTMosMEOtn0I+HgiCzehRGQI64OSBs1omcby2TLFiB67p55rpzGcNdAm/tiwWySVZm/CgTIoz2Z3BFm/7Lq7LdzUfttL/N7F68d2izHDgo7+9yWOY2nYAZw6BaMH3xsvd0jxkH1U06VXMOkuUFwBdyd/c0vCuf9NMOZ9r7namhR0=
